<!DOCTYPE html>
<html lang=" en-US">

<head>
  <meta charset="UTF-8">

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Flask Notes | Hi, I’m Omkar</title>
<meta name="generator" content="Jekyll v3.9.5" />
<meta property="og:title" content="Flask Notes" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Developer Creator Engineer" />
<meta property="og:description" content="Developer Creator Engineer" />
<link rel="canonical" href="https://omkarshelar.dev/other/flask-notes.html" />
<meta property="og:url" content="https://omkarshelar.dev/other/flask-notes.html" />
<meta property="og:site_name" content="Hi, I’m Omkar" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-04-02T05:29:04+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Flask Notes" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2019-04-02T05:29:04+00:00","datePublished":"2019-04-02T05:29:04+00:00","description":"Developer Creator Engineer","headline":"Flask Notes","mainEntityOfPage":{"@type":"WebPage","@id":"https://omkarshelar.dev/other/flask-notes.html"},"url":"https://omkarshelar.dev/other/flask-notes.html"}</script>
<!-- End Jekyll SEO tag -->

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Omkar Shelar's Personal Website">
  <meta property="og:description" content="Omkar Shelar's Personal Website" />
  <meta name="twitter:card" content="summary">
  </meta>
  <meta name="twitter:creator" value="@omkarshelar24">
  <meta name="theme-color" content="#157878">
  <link rel="stylesheet" href="/assets/css/style.css?v=e803bdad1ad355a9940a72c21563ee335e609939">
  <link rel="stylesheet" href="/assets/font-awesome.min.css">
  <link rel="stylesheet" href="/assets/custom.css">
  <link rel="stylesheet" href="/assets/asciinema-player.css">
</head>

<body>
  <section class="page-header">
    
    <h1 class="project-name">Flask Notes</h1>
    <h2 class="project-tagline"></h2>
    
    
    
    
    
  </section>

  <section class="main-content">
    <h3 id="initialization">Initialization:</h3>
<p>Flask apps must create application instance.
App instance is object of class <code class="language-plaintext highlighter-rouge">Flask</code>
To create app instance use,</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
<span class="c1"># 'app' is the application instance
</span></code></pre></div></div>
<p><code class="language-plaintext highlighter-rouge">Flask</code> class has to receive one argument. That argument is the name of main module/package of application(hence <code class="language-plaintext highlighter-rouge">__name__</code>).</p>

<p>Flask uses the argument given while creating app instance to determine root path of the application. It later finds other resources relative to this path.</p>

<h3 id="routes-and-view-functions">Routes and view functions:</h3>
<p>App instance needs to know what code to run for each URL requested. So it keeps mapping of URL to python functions.
The association between a URl and the function that handles it is called a ‘route’.
In flask apps, we use decorator <code class="language-plaintext highlighter-rouge">@app.route</code> to define routes. It registers the decorated function as a route.</p>

<p>Eg:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">'/'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
	<span class="k">return</span> <span class="s">'&lt;h1&gt;Hello World!&lt;/h1&gt;'</span>
</code></pre></div></div>
<p>return value of the function is called response.
<code class="language-plaintext highlighter-rouge">index()</code> is called ‘view function’.</p>

<h5 id="url-patternsdynamic-urls">URL patterns(dynamic URLs):</h5>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">'/user/&lt;name&gt;'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">user</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
	<span class="k">return</span> <span class="s">'&lt;h1&gt;Hello, %s!&lt;/h1&gt;'</span> <span class="o">%</span> <span class="n">name</span>
</code></pre></div></div>
<p><code class="language-plaintext highlighter-rouge">@app.route('/user/&lt;name&gt;')</code> : <code class="language-plaintext highlighter-rouge">&lt;name&gt;</code> can be any variable of any type. Python treats the <code class="language-plaintext highlighter-rouge">&lt;name&gt;</code> as a string.</p>

<p>To restrict only some types of variables in URL patterns:
<code class="language-plaintext highlighter-rouge">/user/&lt;int:id&gt;</code> : Only <code class="language-plaintext highlighter-rouge">int</code> in the URL allowed.</p>

<p>Flask supports types int , float , and path for routes. The path type also represents a string but does not consider slashes as separators and instead considers them part of the dynamic component.</p>

<h3 id="server-startup">Server Startup:</h3>
<p>Application instance has <code class="language-plaintext highlighter-rouge">run()</code> method that starts Flask’s web server.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
	<span class="n">app</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">debug</code> set to False during production.</p>

<h3 id="how-flask-works">How Flask works!</h3>

<h5 id="request-context">Request Context:</h5>
<p>Flask makes a few objects available to view function that handles that the request made by the client.
Eg : <code class="language-plaintext highlighter-rouge">request</code> object which encapsulates the HTTP request sent by the client.
Flask uses <em>contexts</em> to make certain objects temporarily globally accessible.</p>

<p>Eg:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">'/'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
	<span class="n">user_agent</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">headers</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'User_Agent'</span><span class="p">)</span>
	<span class="k">return</span> <span class="s">'&lt;h1&gt;Your browser is %s&lt;/h1&gt;'</span> <span class="o">%</span> <span class="n">user_agent</span>
</code></pre></div></div>

<p><strong>Note :</strong> Request object is available globally in a thread not globally across the application.</p>

<p>To print the URL map:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span><span class="kn">from</span> <span class="nn">hello</span> <span class="kn">import</span> <span class="n">app</span>
<span class="o">&gt;&gt;&gt;</span><span class="n">app</span><span class="p">.</span><span class="n">url_map</span>
</code></pre></div></div>

<h5 id="request-hooks">Request Hooks:</h5>
<p>Certain functions which are executed before or after each view function.
Like DB connection code user Auth code.
Instead of duplicating the code, <em>Request Hooks</em> are used.
Request hooks are implemented as decorators.</p>

<p>Four hooks supported by Flask:</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">before_first_request</code> : Register a function to run before the first request is handled.</li>
  <li><code class="language-plaintext highlighter-rouge">before_request</code> : Before each request.</li>
  <li><code class="language-plaintext highlighter-rouge">after_request</code> : After each request which do not produce unhandled exception(s).</li>
  <li><code class="language-plaintext highlighter-rouge">teardown_request</code> : After each request even if unhandled exception(s) occurs.</li>
</ul>

<p>To share data between request hook functions and view functions, use <code class="language-plaintext highlighter-rouge">g</code> context global.</p>

<h5 id="responses">Responses:</h5>
<p>When Flask invokes a view function, it expects the return value to be the response to the request.</p>

<p>HTTP protocol requires status code, string(HTML document) and man other things as a response to request.</p>

<p>Flask by default sets the HTTP status code to 200 (OK).</p>

<p>When a view function needs to respond with a different status code, it can add status code as second return value.
Eg:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">'/'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
	<span class="k">return</span> <span class="s">'&lt;h1&gt;Bad Request&lt;/h1&gt;'</span><span class="p">,</span> <span class="mi">400</span>
</code></pre></div></div>
<p>Responses returned by view functions can also take a third argument, a dictionary of headers that are added to the HTTP response.</p>

<p>Instead of returning three values, we can also return <code class="language-plaintext highlighter-rouge">Response</code> objects from the view function. <code class="language-plaintext highlighter-rouge">make_response()</code> method takes these arguments and returns a <code class="language-plaintext highlighter-rouge">Response</code> object.
This can be used when we have to modify response inside view function(using methods of <code class="language-plaintext highlighter-rouge">Response</code> object).
Eg:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">make_response</span>
<span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">'/'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
	<span class="n">response</span> <span class="o">=</span> <span class="n">make_response</span><span class="p">(</span><span class="s">'&lt;h1&gt;This document carries a cookie!&lt;/h1&gt;'</span><span class="p">)</span>
	<span class="n">response</span><span class="p">.</span><span class="n">set_cookie</span><span class="p">(</span><span class="s">'answer'</span><span class="p">,</span> <span class="s">'42'</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">response</span>
</code></pre></div></div>
<p>To create a <code class="language-plaintext highlighter-rouge">redirect</code> response:
Eg:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">redirect</span>
<span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">'/'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
	<span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s">'http://www.example.com'</span><span class="p">)</span>
</code></pre></div></div>

<p>To return <code class="language-plaintext highlighter-rouge">abort</code> response:
Eg:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">abort</span>
<span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">'/user/&lt;id&gt;'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">get_user</span><span class="p">(</span><span class="nb">id</span><span class="p">):</span>
	<span class="n">user</span> <span class="o">=</span> <span class="n">load_user</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
	<span class="k">if</span> <span class="ow">not</span> <span class="n">user</span><span class="p">:</span>
		<span class="n">abort</span><span class="p">(</span><span class="mi">404</span><span class="p">)</span>
	<span class="k">return</span> <span class="s">'&lt;h1&gt;Hello, %s&lt;/h1&gt;'</span> <span class="o">%</span> <span class="n">user</span><span class="p">.</span><span class="n">name</span>
</code></pre></div></div>

<h3 id="the-request-context">The Request Context:</h3>
<p>To import <code class="language-plaintext highlighter-rouge">request</code> object:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">request</span>
</code></pre></div></div>
<h5 id="to-get-headers">To get headers:</h5>
<p><code class="language-plaintext highlighter-rouge">request.headers</code> is a python dictionary.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">request</span><span class="p">.</span><span class="n">headers</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'your-header-name'</span><span class="p">)</span>
<span class="c1"># OR
</span><span class="n">request</span><span class="p">.</span><span class="n">headers</span><span class="p">[</span><span class="s">'your-header-name'</span><span class="p">]</span>
</code></pre></div></div>

<h5 id="to-get-paramsargs">To get params(args):</h5>
<p>For the GET request <code class="language-plaintext highlighter-rouge">localhost:5000/?name=Hello,asdf</code>
Use:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">print</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">args</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'name'</span><span class="p">))</span>
<span class="c1"># OR
</span><span class="k">print</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">args</span><span class="p">[</span><span class="s">'name'</span><span class="p">])</span>
<span class="c1"># OR
</span><span class="k">print</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">args</span><span class="p">))</span>
</code></pre></div></div>
<p>Output for last print statement:
<code class="language-plaintext highlighter-rouge">{'name': ['Hello,asdf']}</code></p>

<h5 id="to-get-form-details-in-putpost">To get form details in PUT/POST:</h5>
<p>Use:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">d</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">.</span><span class="n">items</span><span class="p">())</span>
<span class="c1"># OR
</span><span class="k">print</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'Name'</span><span class="p">))</span>
<span class="c1"># OR
</span><span class="k">print</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">[</span><span class="s">'Name'</span><span class="p">])</span>
</code></pre></div></div>
<h5 id="to-get-raw-json-in-putpost">To get raw json in PUT/POST:</h5>
<p>Use:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">print</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">get_json</span><span class="p">())</span>
</code></pre></div></div>
<p>It will be available as a python dict object.
<strong>Note:</strong> Make sure the header Content-Type is set to application/json for this to work.</p>



    <!-- <footer class="site-footer">
        
        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a>.</span>
      </footer> -->
    <!--Content Ends Here!-->
    <hr>
    <footer>
      <p class="custom-footer">
        <a href="https://github.com/omkarshelar" target="_blank">GitHub<i class="fa fa-external-link"
            aria-hidden="true"></i>
        </a>|
        <a href="https://www.linkedin.com/in/omkar-shelar-889783166/" target="_blank">LinkedIn<i
            class="fa fa-external-link" aria-hidden="true"></i>
        </a>|
        <a href="https://twitter.com/omkarshelar24" target="_blank">Twitter<i class="fa fa-external-link"
            aria-hidden="true"></i>
        </a>
      </p>

      <p class="custom-footer">Made with <i class="fa fa-heart" aria-hidden="true"></i> by Omkar Shelar</p>
    </footer>
  </section>

  
  <script>
    (function (i, s, o, g, r, a, m) {
      i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
        (i[r].q = i[r].q || []).push(arguments)
      }, i[r].l = 1 * new Date(); a = s.createElement(o),
        m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

    ga('create', 'UA-114652654-1', 'auto');
    ga('send', 'pageview');
  </script>
  
</body>

</html>